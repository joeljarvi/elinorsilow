policies:
  shell:
    mode: strict
    allow: []
    deny:
      - "*"

name: artist-ui-refactor
description: >
  Safe, staged UI/UX refactor workflow for Next.js projects.
  Prevents hallucinations and large unintended rewrites.

steps:
  - id: audit
    name: Architecture & Performance Audit
    model: gemini-2.5-pro-preview
    input:
      include:
        - app/**
        - components/**
        - context/**
        - styles/**
    prompt: |
      You are analyzing an existing Next.js App Router project.

      Rules:
      - Do NOT change any code.
      - Only read and report.
      - Only talk about files that exist.
      - No assumptions.

      Tasks:
      1. Map the navigation flow (NavContext, view modes, modals).
      2. Identify why loading feels slow:
         - context re-renders
         - image loading
         - animations
         - carousels
      3. List which components rerender when:
         - filters change
         - a modal opens
         - navigation switches

      Output:
      - A short architecture summary
      - A bullet list of performance bottlenecks
      - A file list ranked by impact

  - id: design
    name: UX & Architecture Improvement Proposals
    model: gemini-2.5-pro-preview
    depends_on: audit
    input:
      include:
        - app/**
        - components/**
        - context/**
        - styles/**
    prompt: |
      You are continuing from the audit step.

      Rules:
      - Do NOT modify or rewrite any code.
      - Do NOT invent files or components.
      - Only reference files that exist in the input.
      - Provide proposals only.

      Goals:

      1. Suggest performance and architecture improvements
         - Identify where state should move into context
         - Suggest memoization, splitting, or lazy-loading
         - Highlight any unnecessary rerenders

      2. "Information" page completion
         - Locate the current "view=info" implementation
         - Identify unfinished sections (after "All exhibitions")
         - Propose layout + typography styles that match the existing style
         - On desktop, design it as a 2-column grid (grid-cols-2)
         - Describe spacing, hierarchy, and grouping — no CSS yet

      3. Navigation & NavContext review
         - Map all nav-related states and handlers
         - Propose which ones could live in context instead of components
         - Do NOT move anything yet — just recommend
         - Flag any redundant or overlapping state

      4. Filters UI redesign
         - Identify filter components (works + exhibitions)
         - Propose a button-based UI instead of <Select>
         - Define button groups, active states, and layout logic
         - No implementation yet

      5. Text visibility system (CSS-based)
         - Replace the "Show Text / Show Info" toggle
         - Propose a global CSS class or data-attribute strategy
         - Describe how it fades all text elements:
           buttons, h1–h4, p, spans, font-gintoRegular, etc
         - Must work without conditional rendering

      Output format:

      ---
      ## 1. Architecture & Performance Proposals
      - ...

      ## 2. Information Page Design Plan
      - ...

      ## 3. Nav & Context Refactor Suggestions
      - ...

      ## 4. Filter UI Redesign Plan
      - ...

      ## 5. Global Text Visibility System
      - ...
      ---

  - id: plan
    name: Staged Refactor Plan (Approval Required)
    model: gemini-2.5-pro-preview
    depends_on: design
    prompt: |
      Convert the design proposals into a step-by-step refactor plan.

      Rules:
      - Do NOT write code yet.
      - Group changes by file.
      - Mark which changes require user approval.
      - Each step must be reversible.

      Output format:

      ---
      ## Phase 1 – Safe refactors (no behavior change)
      - File: ...
        Change: ...
        Risk: Low

      ## Phase 2 – UI changes (requires approval)
      - File: ...
        Change: ...
        Risk: Medium

      ## Phase 3 – Architecture changes (requires approval)
      - File: ...
        Change: ...
        Risk: High
      ---

  - id: apply
    name: Controlled Refactor (Runs Only After Approval)
    model: gemini-2.5-pro-preview
    depends_on: plan
    prompt: |
      You may now apply changes ONLY if the user has explicitly approved
      specific phases from the plan.

      Rules:
      - Only change files listed in the approved phases.
      - Do NOT touch any other files.
      - Preserve existing logic unless explicitly replaced.
      - Apply changes one file at a time.
      - After each file, summarize what changed.

      Required preface in output:
      "Waiting for phase approval: Phase 1 / Phase 2 / Phase 3"
